<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f9;
        }

        .calculator {
            width: 320px;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .calculator-display {
            width: 100%;
            height: 70px;
            background: #f1f1f1;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 20px;
            padding: 5px 10px;
            font-size: 1.5rem;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #operator-display {
            font-size: 1rem;
            color: gray;
            text-align: right;
            height: 20px;
            line-height: 20px;
        }

        #display {
            font-size: 1.5rem;
            text-align: right;
            border: none;
            background: none;
            width: 100%;
            box-sizing: border-box;
            height: 40px;
            padding: 0;
            margin: 0;
            outline: none;
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .calculator-button {
            height: 50px;
            font-size: 1.2rem;
            background: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
        }

        .calculator-button:active {
            background: #0056b3;
        }

        .calculator-button.decimal {
            position: relative;
        }

        .calculator-button.decimal::before {
            content: '.';
            font-size: 1.2rem;
            position: absolute;
            top: 50%;
            transform: translateY(-60%);
        }

        .calculator-button.clear {
            background: #e63946;
        }

        .calculator-button.clear:active {
            background: #b02a36;
        }

        .calculator-button.equals {
            background: #28a745;
            grid-column: span 2;
        }

        .calculator-button.equals:active {
            background: #1d7c32;
        }

        .calculator-button.special {
            background: #6A5ACD;
            color: #fff;
        }

        .calculator-button.special:active {
            background: #5A4AB0;
        }

        .calculator-button.operator {
            background: #FFA500;
            color: #fff;
        }

        .calculator-button.operator:active {
            background: #cc8400;
        }
    </style>
</head>

<body>
    <div class="calculator">
        <div class="calculator-display">
            <div id="operator-display"></div>
            <input type="text" id="display" disabled>
        </div>
        <div class="calculator-buttons">
            <button class="calculator-button special" onclick="calculateSquareRoot()">√</button>
            <button class="calculator-button special" onclick="calculateSquare()">x²</button>
            <button class="calculator-button clear" onclick="clearDisplay()">C</button>
            <button class="calculator-button operator" onclick="setOperation('/')">÷</button>

            <button class="calculator-button" onclick="appendNumber('7')">7</button>
            <button class="calculator-button" onclick="appendNumber('8')">8</button>
            <button class="calculator-button" onclick="appendNumber('9')">9</button>
            <button class="calculator-button operator" onclick="setOperation('*')">×</button>

            <button class="calculator-button" onclick="appendNumber('4')">4</button>
            <button class="calculator-button" onclick="appendNumber('5')">5</button>
            <button class="calculator-button" onclick="appendNumber('6')">6</button>
            <button class="calculator-button operator" onclick="setOperation('-')">−</button>

            <button class="calculator-button" onclick="appendNumber('1')">1</button>
            <button class="calculator-button" onclick="appendNumber('2')">2</button>
            <button class="calculator-button" onclick="appendNumber('3')">3</button>
            <button class="calculator-button operator" onclick="setOperation('+')">+</button>

            <button class="calculator-button" onclick="appendNumber('0')">0</button>
            <button class="calculator-button decimal" onclick="appendDecimal()"></button>
            <button class="calculator-button equals" onclick="calculate()">=</button>
        </div>
    </div>

    <script>
        let currentInput = '';
        let previousInput = '';
        let operation = null;
        let isResultDisplayed = false;
        let lastNumber = null;

        const display = document.getElementById('display');

        function appendNumber(number) {
            if (isResultDisplayed) {
                currentInput = '';
                isResultDisplayed = false;
            }
            currentInput += number;
            updateDisplay();
        }

        function appendDecimal() {
            if (isResultDisplayed) {
                currentInput = '0';
                isResultDisplayed = false;
            }
            if (!currentInput.includes('.')) {
                currentInput += '.';
            }
            updateDisplay();
        }

        function setOperation(op) {
            if (currentInput === '' && previousInput === '') return;

            if (operation === op) {
                repeatOperation();
                return;
            }

            if (operation !== null) {
                calculate();
            }

            operation = op;
            previousInput = currentInput;
            lastNumber = parseFloat(currentInput);
            currentInput = '';
            isResultDisplayed = false;

            updateOperatorDisplay(op);
        }

        function updateOperatorDisplay(op) {
            const operatorMap = {
                '+': '+',
                '-': '−',
                '*': '×',
                '/': '÷'
            };
            document.getElementById('operator-display').textContent = operatorMap[op] || '';
        }

        function calculate() {
            if (!operation || currentInput === '' || previousInput === '') return;

            const prev = parseFloat(previousInput);
            const curr = parseFloat(currentInput || lastNumber);
            let result = 0;

            switch (operation) {
                case '+':
                    result = prev + curr;
                    break;
                case '-':
                    result = prev - curr;
                    break;
                case '*':
                    result = prev * curr;
                    break;
                case '/':
                    result = prev / curr;
                    break;
                default:
                    return;
            }

            currentInput = result.toString();
            previousInput = currentInput;
            lastNumber = curr;
            operation = null;
            updateOperatorDisplay('');
            isResultDisplayed = true;
            updateDisplay();
        }

        function repeatOperation() {
            if (!operation || lastNumber === null) return;

            const prev = parseFloat(currentInput || previousInput);
            const result = operation === '+' ? prev + lastNumber
                : operation === '-' ? prev - lastNumber
                    : operation === '*' ? prev * lastNumber
                        : operation === '/' ? prev / lastNumber
                            : prev;

            currentInput = result.toString();
            previousInput = currentInput;
            isResultDisplayed = true;
            updateDisplay();
        }

        function calculateSquareRoot() {
            if (currentInput === '') return;
            currentInput = Math.sqrt(parseFloat(currentInput)).toString();
            isResultDisplayed = true;
            updateOperatorDisplay('');
            updateDisplay();
        }

        function calculateSquare() {
            if (currentInput === '') return;
            currentInput = Math.pow(parseFloat(currentInput), 2).toString();
            isResultDisplayed = true;
            updateOperatorDisplay('');
            updateDisplay();
        }

        function clearDisplay() {
            currentInput = '';
            previousInput = '';
            operation = null;
            lastNumber = null;
            isResultDisplayed = false;
            updateOperatorDisplay('');
            updateDisplay();
        }

        function updateDisplay() {
            display.value = formatNumber(currentInput) || '0';
        }

        function formatNumber(num) {
            if (num === '') return '';
            const [integer, decimal] = num.split('.');
            const formattedInteger = parseFloat(integer).toLocaleString();
            return decimal ? `${formattedInteger}.${decimal}` : formattedInteger;
        }
    </script>
</body>

</html>
